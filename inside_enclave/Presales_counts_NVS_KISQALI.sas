/* Presales NVS Kisqali Counts - By Group*/

/* Issue: https://github.com/CareSet/NVS_Kisqali/issues/1 */

/* The SQL code groups the NDC by Product Name to get distinct counts within the group (FY2020, Part D) */


PROC SQL; 
CREATE TABLE IVA461SL.NVS_KISQALI_COUNTS_GROUP AS
SELECT 
        CASE WHEN  prod_srvc_id IN ('00093112589',
                                    '00143959721',
                                    '00378692078',
                                    '42291002412',
                                    '51407018112',
                                    '57894015512',
                                    '60505432701',
                                    '60687045511',
                                    '60687045521',
                                    '64679002101',
                                    '64980041812',
                                    '69238116507',
                                    '72205003092',
                                    '00378692191',
                                    '00904694804',
                                    '16714096301',
                                    '42292005701',
                                    '42292005703',
                                    '43598035804',
                                    '60505432703',
                                    '68001048907',
                                    '68462013508',
                                    '69238175406',
                                    '69539004992',
                                    '72606056601') 
        THEN 'Abiraterone Acetate' 

        WHEN  prod_srvc_id IN ('00069914111',
                                '00069914122',
                                '00069914211',
                                '00069914222',
                                '00069914411',
                                '00409020102',
                                '00409020110',
                                '00409020120',
                                '00409020125',
                                '00409020126',
                                '00409020127',
                                '00409036601',
                                '00409036701',
                                '00409036801',
                                '00703572001',
                                '00703573001',
                                '00955102001',
                                '00955102104',
                                '00955102208',
                                '16714046501',
                                '16714050001',
                                '16729012049',
                                '16729022850',
                                '16729023163',
                                '16729023164',
                                '16729023165',
                                '16729026763',
                                '16729026764',
                                '16729026765',
                                '25021022201',
                                '25021022204',
                                '25021022207',
                                '25021024501',
                                '25021024504',
                                '39822212001',
                                '39822218001',
                                '39822220001',
                                '42367012121',
                                '42367012125',
                                '42367012129',
                                '43066000101',
                                '43066000601',
                                '43066001001',
                                '43598025811',
                                '43598025940',
                                '43598038957',
                                '43598061040',
                                '43598061111',
                                '45963073452',
                                '45963073454',
                                '45963073474',
                                '45963076552',
                                '45963079056',
                                '50742042802',
                                '50742043108',
                                '50742046316',
                                '60505603506',
                                '60505603706',
                                '63739093211',
                                '63739097117',
                                '66758005001',
                                '66758005002',
                                '66758005003',
                                '66758095002',
                                '66758095003',
                                '66758095004',
                                '67457053102',
                                '67457053208',
                                '67457053316',
                                '67457078108',
                                '72485021401',
                                '72485021504',
                                '72485021608',
                                '00143920401',
                                '00143920501',
                                '47335032340',
                                '47335089540',
                                '47335093940',
                                '57884302100',
                                '57884304101',
                                '57884304201',
                                '57884304301',
                                '70121122101',
                                '70121122201',
                                '70121122301',
                                '71288014302',
                                '71288014408',
                                '71288014416',
                                '71288015095',
                                '71288015195',
                                '71288015196') 
        THEN 'Docetaxel'

        WHEN  prod_srvc_id IN ('59676060056',
                                '59676060099',
                                '59676060012') 
        THEN 'Erleada'

        WHEN  prod_srvc_id IN ('00024582411',
                                '00024582201',
                                '00024582315') 
        THEN 'Jevtana'

                    
        WHEN  prod_srvc_id IN ('00310066812',
                                '00310066860',
                                '00310067912',
                                '00310067960',
                                '00310067995') 
        THEN 'Lynparza'

        WHEN  prod_srvc_id IN ('50419039501',
                                '50419039572') 
        THEN 'Nubeqa'

        WHEN  prod_srvc_id IN ('69660020191',
                                '69660020291',
                                '69660020391') 
        THEN 'Rubraca'

        WHEN  prod_srvc_id IN ('50419020801') 
        THEN 'Xofigo'
                    
        WHEN  prod_srvc_id IN ('00469012599',
                                '00469062599',
                                '00469072560') 
        THEN 'Xtandi'

        WHEN  prod_srvc_id IN ('47335040181') 
        THEN 'Yonsa'

        WHEN  prod_srvc_id IN ('57894019515',
                            '57894015012',
                            '57894019506') 
        THEN 'Zytiga'

        WHEN prod_srvc_id IN ('00069018721',
                                '00069018821',
                                '00069018921',
                                '00069028403',
                                '00069028407',
                                '00069048603',
                                '00069048607',
                                '00069068803',
                                '00069068807',
                                '63539018711',
                                '63539018811',
                                '63539018911',
                                '63539028403',
                                '63539028407',
                                '63539048603',
                                '63539048607',
                                '63539068803',
                                '63539068807')
        THEN 'Ibrance'

        WHEN prod_srvc_id IN ('00078086001',
                                '00078086742',
                                '00078086714',
                                '00078087463',
                                '00078087421')
        THEN 'Kisqali'

        WHEN prod_srvc_id IN ('00078090961',
                                '00078088150',
                                '00078088821',
                                '00078091661',
                                '00078089514',
                                '00078092361',
                                '00078090221')
        THEN 'KISQALI FEMARA COPACK'

        WHEN prod_srvc_id IN ('00002448354',
                                '00002481554',
                                '00002533754',
                                '00002533763',
                                '00002621654')
        THEN 'Verzenio'


        END AS product_name,

        COUNT (DISTINCT bene_id) AS cnt_bene_id,
        COUNT (DISTINCT prscrbr_id) AS cnt_prscrbr_id,
        COUNT (DISTINCT pde_id) AS cnt_pde_id
FROM SH027654.X_PDE_DEFAULT_STACK_20
WHERE prod_srvc_id IN ('00093112589',
'00143959721',
'00378692078',
'42291002412',
'51407018112',
'57894015512',
'60505432701',
'60687045511',
'60687045521',
'64679002101',
'64980041812',
'69238116507',
'72205003092',
'00378692191',
'00904694804',
'16714096301',
'42292005701',
'42292005703',
'43598035804',
'60505432703',
'68001048907',
'68462013508',
'69238175406',
'69539004992',
'72606056601',
'00069914111',
'00069914122',
'00069914211',
'00069914222',
'00069914411',
'00409020102',
'00409020110',
'00409020120',
'00409020125',
'00409020126',
'00409020127',
'00409036601',
'00409036701',
'00409036801',
'00703572001',
'00703573001',
'00955102001',
'00955102104',
'00955102208',
'16714046501',
'16714050001',
'16729012049',
'16729022850',
'16729023163',
'16729023164',
'16729023165',
'16729026763',
'16729026764',
'16729026765',
'25021022201',
'25021022204',
'25021022207',
'25021024501',
'25021024504',
'39822212001',
'39822218001',
'39822220001',
'42367012121',
'42367012125',
'42367012129',
'43066000101',
'43066000601',
'43066001001',
'43598025811',
'43598025940',
'43598038957',
'43598061040',
'43598061111',
'45963073452',
'45963073454',
'45963073474',
'45963076552',
'45963079056',
'50742042802',
'50742043108',
'50742046316',
'60505603506',
'60505603706',
'63739093211',
'63739097117',
'66758005001',
'66758005002',
'66758005003',
'66758095002',
'66758095003',
'66758095004',
'67457053102',
'67457053208',
'67457053316',
'67457078108',
'72485021401',
'72485021504',
'72485021608',
'00143920401',
'00143920501',
'47335032340',
'47335089540',
'47335093940',
'57884302100',
'57884304101',
'57884304201',
'57884304301',
'70121122101',
'70121122201',
'70121122301',
'71288014302',
'71288014408',
'71288014416',
'71288015095',
'71288015195',
'71288015196',
'59676060056',
'59676060099',
'59676060012',
'00024582411',
'00024582201',
'00024582315',
'00310066812',
'00310066860',
'00310067912',
'00310067960',
'00310067995',
'50419039501',
'50419039572',
'69660020191',
'69660020291',
'69660020391',
'50419020801',
'00469012599',
'00469062599',
'00469072560',
'47335040181',
'57894019515',
'57894015012',
'57894019506',
'00069018721',
'00069018821',
'00069018921',
'00069028403',
'00069028407',
'00069048603',
'00069048607',
'00069068803',
'00069068807',
'63539018711',
'63539018811',
'63539018911',
'63539028403',
'63539028407',
'63539048603',
'63539048607',
'63539068803',
'63539068807',
'00078086001',
'00078086742',
'00078086714',
'00078087463',
'00078087421',
'00078090961',
'00078088150',
'00078088821',
'00078091661',
'00078089514',
'00078092361',
'00078090221',
'00002448354',
'00002481554',
'00002533754',
'00002533763',
'00002621654')
GROUP BY product_name;
QUIT;
